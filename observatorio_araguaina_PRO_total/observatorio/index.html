<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ObservatÃ³rio AraguaÃ­na â€” Mapa Integrado</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Leaflet Draw -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

  <!-- Leaflet Heat -->
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

  <!-- Chart.js (mini-grÃ¡ficos) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app">
   <header>
  <div class="brand">ğŸ—ºï¸ ObservatÃ³rio AraguaÃ­na</div>
  <div class="spacer"></div>

  <div class="toggle-group">
    <label class="toggle"><input id="chkHeat" type="checkbox"/><span>Heatmap</span></label>
    <label class="toggle"><input id="chkLabels" type="checkbox" checked/><span>RÃ³tulos</span></label>

    <button id="btn-missing" class="chip">
      ğŸ§© Faltando no mapa <span id="missing-badge" class="badge-mini" style="display:none">0</span>
    </button>

    <button id="btn-credits" class="chip">
      CrÃ©ditos
    </button>
  </div>
</header>

    <aside>
      <div class="tabs">
        <button class="tab active" data-tab="vd">ViolÃªncia DomÃ©stica</button>
        <button class="tab" data-tab="mi">Moradia Irregular</button>
        <button class="tab" data-tab="infra">Infraestrutura</button>
        <button class="tab" data-tab="imps">IncidÃªncia MidiÃ¡tica â€“ Programas Sociais</button>
        <button class="tab" data-tab="vg">ViolÃªncia Geral</button>
        <button class="tab" data-tab="psr">Pessoas em SituaÃ§Ã£o de Rua</button>
        <button class="tab" data-tab="cg">Criminalidade Geral</button>
      </div>

      <div id="tab-content">
        <!-- Cada aba tem um slot para receber a legenda -->
        <div class="tab-panel" data-panel="vd" style="display:block;">
          <div class="legend-slot"></div>
          <h2>ViolÃªncia DomÃ©stica</h2>
          <p class="muted">Bairros, justificativas e heatmap por incidÃªncia.</p>
        </div>

        <div class="tab-panel" data-panel="mi">
          <div class="legend-slot"></div>
          <h2>Moradia Irregular</h2>
          <p class="muted">IncidÃªncia estimada por bairro com justificativa.</p>
        </div>

        <div class="tab-panel" data-panel="infra">
          <div class="legend-slot"></div>
          <h2>Infraestrutura</h2>
          <p class="muted">DeficiÃªncias reportadas (Ã¡gua, iluminaÃ§Ã£o, esgoto). A cor reflete a incidÃªncia; o popup mostra o tipo e observaÃ§Ãµes.</p>
        </div>

        <div class="tab-panel" data-panel="imps">
          <div class="legend-slot"></div>
          <h2>IncidÃªncia MidiÃ¡tica â€“ Programas Sociais</h2>
          <p class="muted">Bairros com maior visibilidade em aÃ§Ãµes sociais (cestas, auxÃ­lios, etc.).</p>
        </div>

        <div class="tab-panel" data-panel="vg">
          <div class="legend-slot"></div>
          <h2>ViolÃªncia Geral</h2>
          <p class="muted">MenÃ§Ãµes midiÃ¡ticas de crimes por bairro (roubos, furtos etc.).</p>
        </div>

        <div class="tab-panel" data-panel="psr">
          <div class="legend-slot"></div>
          <h2>Pessoas em SituaÃ§Ã£o de Rua</h2>
          <p class="muted">ConcentraÃ§Ã£o estimada e justificativa por Ã¡rea.</p>
        </div>

        <div class="tab-panel" data-panel="cg">
          <div class="legend-slot"></div>
          <h2>Criminalidade Geral</h2>
          <p class="muted">ClassificaÃ§Ã£o por incidÃªncia e justificativa por bairro/Ã¡rea.</p>
        </div>

        <div class="legend">
          <div><strong>Ranking (Top 10)</strong></div>
          <div id="ranking" class="ranking"></div>
        </div>

        <div class="card small">
          <h3>Mini-grÃ¡fico (bairro selecionado)</h3>
          <canvas id="miniChart" height="140"></canvas>
          <div id="miniInfo" class="muted" style="margin-top:6px"></div>
        </div>
      </div>
    </aside>

    <div id="map"></div>
  </div>


  <!-- LEGENDA GLOBAL (serÃ¡ movida para o slot da aba ativa pelo JS) -->
  <div id="legend-levels" class="legend-levels">
    <div class="legend-title">NÃ­veis</div>
    <div class="legend-pills">
      <span class="pill pill-alta">Alta</span>
      <span class="pill pill-media-alta">MÃ©dia-alta</span>
      <span class="pill pill-media">MÃ©dia</span>
      <span class="pill pill-media-baixa">MÃ©dia-baixa</span>
      <span class="pill pill-baixa">Baixa</span>
      <span class="pill pill-muito-baixa">Muito baixa</span>
    </div>
  </div>

  <!-- Modal: CrÃ©ditos -->
  <div id="creditsModal" class="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-labelledby="creditsTitle">
      <button class="modal-close" id="closeCredits" aria-label="Fechar">&times;</button>
      <h2 id="creditsTitle">CrÃ©ditos</h2>
      <ul id="creditsList"></ul>
    </div>
  </div>

  <!-- Modal: Faltando no mapa -->
  <div id="missingModal" class="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-labelledby="missingTitle">
      <button class="modal-close" id="closeMissing" aria-label="Fechar">&times;</button>
      <h2 id="missingTitle">Bairros com dado, mas nÃ£o desenhados</h2>
      <p class="muted" style="margin-top:-4px">
      </p>
      <ul id="missingList" class="missing-list"></ul>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
